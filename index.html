<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Perpetual Breakdown</title>
	<link href="https://fonts.googleapis.com/css?family=Nova+Round|Ubuntu" rel="stylesheet">
	<link rel="stylesheet" href="styles.css">
</head>
<body>
	<div id="container">
		<div id="overview">
			<div class="horizontalCenter">
				<h1>Perpetual Breakdown</h1>
			</div>
			<p>
				Perpetual Breakdown is a procedurally generated metal song created by <a href="https://www.maxstrater.com" target="_blank">Max Strater</a> and <a href="https://www.kylepaulsen.com" target="_blank">Kyle Paulsen</a>. It is based on scheduled sample playback and is written in the key of C minor at 180 bpm. Click the play button at the bottom of the page at any time to start listening.
			</p>
			<p class="sectionsDescription">
				The song structure is composed of <span class="sectionsNumSections"></span> different sections: <span class="sectionsSectionsString"></span>. Each section is detailed below and each section name will be marked with an icon while it is playing. You can also automatically scroll to the currently playing section using the checkbox next to the play button.
			</p>
			<p class="sectionsDescription">
				The first section played is always <i><span class="sectionsFirstSection"></span></i> and then which section is played next is decided using a <a href=https://en.wikipedia.org/wiki/Markov_chain target="_blank">Markov chain</a>. All this really means is that each section has some specific probability to transition to each other section. You can visualize all the different probabilities using a <a href="https://en.wikipedia.org/wiki/Stochastic_matrix" target="_blank">stochastic matrix</a> (also known as a <i>transition matrix</i> or a <i>Markov matrix</i>). The stochastic matrix for the song's sections is shown below. For example, the probability to transition from <i><span class="sectionsFirstSection"></span></i> to <i><span class="sectionsSecondSection"></span></i> is <span class="sectionsProbability"></span>. However, if you want to override the section order, each section has a button next to its name below that will force it to be the next played section.
			</p>
			<div class="horizontalCenter">
				<table id="stochasticMatrixTable"></table>
			</div>
		</div>
		<!-- make sure the section id mathes the section name-->
		<div id="breakdown" class="section">
			<div class="sectionHeader verticalCenter">
				<button class="playSectionNext buttonStyle">Play</br>Next</button>
				<h2>Breakdown</h2>
				<div class="playingIcon hide">
					<img src="assets/recording.svg">
				</div>
				<div class="collapseIcon">
					<img src="assets/collapse.svg">
				</div>
			</div>
			<div class="collapsible">
				<p>
					This section is composed of a semi-random rhythm played on guitar, bass, and drums. The rhythm is made up of smaller component patterns sequenced one after another such that they maintain a strong downbeat every 8 beats. The components used are the following:
				</p>
				<div class="componentsContainer">
				</div>
				<p>
					You can see the rhythm notated in real time as the samples are scheduled here:
				</p>
			</div>
			<div class="horizontalCenter">
				<div class="notationContainer">
					<div class="keySignature"></div>
					<div class="breakdownNotation"></div>
				</div>
			</div>
		</div>
		<div id="augmentedBreakdown" class="section">
			<div class="sectionHeader verticalCenter">
				<button class="playSectionNext buttonStyle">Play</br>Next</button>
				<h2>Augmented Breakdown</h2>
				<div class="playingIcon hide">
					<img src="assets/recording.svg">
				</div>
				<div class="collapseIcon">
					<img src="assets/collapse.svg">
				</div>
			</div>
			<div class="collapsible">
				<p>
					This section is essentially the same as the <i>Breakdown</i> section, but with a few extra embellishments added to the samples. There are very dissonant minor second guitar stabs and high pitched guitar squeals added to the available sounds. The drums also ride the open hi-hat instead of crash symbols. The components used are the following:
				</p>
				<div class="componentsContainer">
				</div>
				<p>
					You can see the rhythm notated in real time as the samples are scheduled here:
				</p>
			</div>
			<div class="horizontalCenter">
				<div class="notationContainer">
					<div class="keySignature"></div>
					<div class="breakdownNotation"></div>
				</div>
			</div>
		</div>
		<div id="counterpoint" class="section">
			<div class="sectionHeader verticalCenter">
				<button class="playSectionNext buttonStyle">Play</br>Next</button>
				<h2>Counterpoint</h2>
				<div class="playingIcon hide">
					<img src="assets/recording.svg">
				</div>
				<div class="collapseIcon">
					<img src="assets/collapse.svg">
				</div>
			</div>
			<div class="collapsible">
				<p>
					This section is created by randomly generating a 16 note line of <a href="https://en.wikipedia.org/wiki/Counterpoint#First_species" target="_blank">first species counterpoint</a>. This means creating two complementary melodies which are then played with tremolo picking on dual guitars. The bass follows the lower melody and the drums play varied blast beats and double bass drum beats. Please note that the rules for creating counterpoint can vary somewhat and the following is just one method. First, a simple melody called a <i>cantus firmus</i> is generated according to the following rules:
				</p>
				<ul>
					<li>Each note has the same length</li>
					<li>Must start on the root note</li>
					<li>Must end with a step down to the root, that is end with second to root</li>
					<li>The allowed melodic intervals (up or down) are a second (scale step), third, fourth, or fifth</li>
					<li>If the melody jumps by a third, fourth, or fifth, it must immediately be followed by a second (a scale step) in the opposite direction of the jump</li>
				</ul>
				<p>
					Once the <i>cantus firmus</i> is finished, a higher pitched 16 note melody line is generated to harmonize note for note against the <i>cantus firmus</i>. This second melody must follow these rules:
				</p>
				<ul>
					<li>Each note has the same length</li>
					<li>Must start on a harmonic interval of an octave above the <i>cantus firmus</i></li>
					<li>Must end with a half step up to an octave above the <i>cantus firmus</i>, meaning the line ends with the harmonic intervals of a major sixth and an octave</li>
					<li>The allowed harmonic intervals are a third, fifth (but not a diminished fifth), sixth, octave, or tenth</li>
					<li>If the melody jumps in one direction by more than a second (a scale step) it must be followed <i>or preceded</i> by a scale step in the opposite direction</li>
					<li>A note cannot be immediately followed by the same note</li>
					<li>Cannot have more than one harmonic interval of a fifth or octave in a row</li>
					<li>Cannot have more than three harmonic intervals of a third, sixth, or tenth in a row</li>
					<li>Cannot have two melodic interval jumps of more than a second (a scale step) in the same direction</li>
					<li>When approaching a harmonic octave or fifth, the melody must move in the opposite direction from the <i>cantus firmus</i></li>
				</ul>
				<p>
					Below is the counterpoint that has been generated this time. When this section is playing the current note will be highlighted below in red.
				</p>
			</div>
			<div class="horizontalCenter">
				<div id="vexFlowCounterpoint"></div>
			</div>
		</div>
		<div id="chromaticCounterpointBridge" class="section">
			<div class="sectionHeader verticalCenter">
				<button class="playSectionNext buttonStyle">Play</br>Next</button>
				<h2>Chromatic Counterpoint Bridge</h2>
				<div class="playingIcon hide">
					<img src="assets/recording.svg">
				</div>
				<div class="collapseIcon">
					<img src="assets/collapse.svg">
				</div>
			</div>
			<div class="collapsible">
				<p>
					Once the 16 note counterpoint line is generated for the <i>Counterpoint</i> section, it is reinterpreted as a short sequence of chromatic hits played on guitar and bass to make this transitional bridge section.
				</p>
				<p>
					For each melodic interval in the counterpoint's <i>cantus firmus</i>, a scale step is replaced with a chromatic step (a half step). For example, a melodic jump of a fifth (four scale steps) becomes a melodic jump of a major third (four half steps). This gives us a chromatic analog of the <i>cantus firmus</i>. Then the harmonic intervals between the two original counterpoint melody lines are adjusted to create the higher melody line for this chromatic section. A harmonic interval of a third (major or minor) becomes a minor third, a fifth stays a fifth, an octave stays an octave, and a tenth (major or minor) becomes a minor tenth. This whole process leaves us with two chromatic melody lines that are reminiscent of the original counterpoint melodies.
				</p>
				<p>
					When this section is playing the current note will be highlighted below in red.
				</p>
			</div>
			<div class="horizontalCenter">
				<div id="vexFlowChromaticCounterpointBridge"></div>
			</div>
		</div>
		<div id="temporary">
			<h2>Temporary</h2>
			<div class="horizontalCenter">
				<div id="vexFlowTemp"></div>
			</div>
		</div>
	</div>
	<div id="controls">
		<div class="verticalCenter">
			<button id="playPause" class="buttonStyle">Play / Pause</button>
			<div class="verticalCenter">
				<input type="checkbox" id="scrollToSection">
				<label for="automaticallyScrollToSection">Automatically scroll to playing section</label>
			</div>
		</div>
	</div>
	<script>
		// setup global namespace
		window.app = {};
	</script>
	<script src="src/vexflow/vexflow-min.js"></script>
	<script src="src/ui.js"></script>
	<script src="src/util.js"></script>
	<script src="src/counterpointGenerator.js"></script>
	<script src="src/soundsDefinition.js"></script>
	<script src="src/songDefinition.js"></script>
	<script src="src/main.js"></script>
</body>
</html>
